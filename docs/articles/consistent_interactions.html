<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Identify significantly different interactions across groups with replicate samples • celltalker</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Identify significantly different interactions across groups with replicate samples">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">celltalker</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.5.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/celltalker.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/consistent_interactions.html">Identify significantly different interactions across groups with replicate samples</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="consistent_interactions_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Identify significantly different interactions across groups with replicate samples</h1>
                        <h4 class="author">Anthony R Cillo</h4>
            
            <h4 class="date">12 April, 2022</h4>
      
      
      <div class="hidden name"><code>consistent_interactions.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates an extension of the core functionality of celltalker to replicate samples. The idea is that this functionality can be used to identify consistently differentially expressed ligand and receptor interactions. To demonstrate this functionality, we will leverage our <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE139324">previously published</a> dataset of healthy donor PBMC and healthy donor tonsils.</p>
<p>The data preprocessing steps are documented in the data-raw directory. We will start with a low-dimensional visualization with annotated cell types.</p>
<div id="load-packages-and-setup-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#load-packages-and-setup-analysis" class="anchor"></a>Load packages and setup analysis</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(celltalker)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Seurat)</span></code></pre></div>
<pre><code>## This version of bslib is designed to work with shiny version 1.5.0.9007 or higher.</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by 'cli':
##   method     from    
##   print.boxx spatstat</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✔ ggplot2 3.3.2     ✔ purrr   0.3.3
## ✔ tibble  3.0.5     ✔ dplyr   1.0.3
## ✔ tidyr   1.0.0     ✔ stringr 1.4.0
## ✔ readr   1.3.1     ✔ forcats 0.4.0</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"filtered_lig_rec"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"overall_metadata"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"overall_umap"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Create a Seurat object based on 5 healthy donor PBMC and 5 healhy donor tonsils</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>ser_obj <span class="ot">&lt;-</span> <span class="fu">CreateSeuratObject</span>(filtered_lig_rec,<span class="at">meta.data=</span>overall_metadata)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>ser_obj[[<span class="st">"umap"</span>]] <span class="ot">&lt;-</span> <span class="fu">CreateDimReducObject</span>(<span class="at">embeddings =</span> overall_umap, <span class="at">key =</span> <span class="st">"UMAP_"</span>, <span class="at">assay =</span> <span class="fu">DefaultAssay</span>(ser_obj))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">DimPlot</span>(ser_obj,<span class="at">group.by=</span><span class="st">"cell_types"</span>,<span class="at">split.by=</span><span class="st">"sample_type"</span>)</span></code></pre></div>
<p><img src="consistent_interactions_files/figure-html/setup-1.png" width="700"></p>
</div>
<div id="run-celltalker" class="section level2">
<h2 class="hasAnchor">
<a href="#run-celltalker" class="anchor"></a>Run celltalker</h2>
<p>Next, we will split the data into PBMC and Tonsil Seurat objects and will identify the top ligand and receptor interactions in each of these datasets</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Split dataset</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ser_split <span class="ot">&lt;-</span> <span class="fu">SplitObject</span>(ser_obj,<span class="at">split=</span><span class="st">"sample_type"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Check out the split data</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>ser_split</span></code></pre></div>
<pre><code>## $PBMC
## An object of class Seurat 
## 204 features across 10836 samples within 1 assay 
## Active assay: RNA (204 features, 0 variable features)
##  1 dimensional reduction calculated: umap
## 
## $Tonsil
## An object of class Seurat 
## 204 features across 12898 samples within 1 assay 
## Active assay: RNA (204 features, 0 variable features)
##  1 dimensional reduction calculated: umap</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Run celltalker - PBMC</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>pbmc_interactions <span class="ot">&lt;-</span> <span class="fu">celltalk</span>(<span class="at">input_object=</span>ser_split[[<span class="st">"PBMC"</span>]],</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">metadata_grouping=</span><span class="st">"cell_types"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ligand_receptor_pairs=</span>ramilowski_pairs,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">number_cells_required=</span><span class="dv">50</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_expression=</span><span class="dv">1000</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_expression=</span><span class="dv">20000</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">scramble_times=</span><span class="dv">10</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Check out the interactions - PBMC</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>pbmc_interactions <span class="sc">%&gt;%</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_val_adj=</span><span class="fu">p.adjust</span>(p_val,<span class="at">method=</span><span class="st">"fdr"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_val_adj<span class="sc">&lt;</span><span class="fl">0.05</span>)</span></code></pre></div>
<pre><code>## # A tibble: 9 x 10
##   interaction_pai… interaction value scram_mean scram_sd   p_val cell_type1
##   &lt;chr&gt;            &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     
## 1 CD14+CD16- mono… CD14_ITGB1  0.995     0.262    0.0536 0.      CD14+CD16…
## 2 CD14+CD16- mono… CD14_ITGB1  0.963     0.251    0.0615 0.      CD14+CD16…
## 3 CD14+CD16- mono… CD14_ITGB1  0.927     0.253    0.0758 0.      CD14+CD16…
## 4 CD1C+ DCs_NK ce… GNAS_ADCY7  0.683     0.383    0.0843 1.89e-4 CD1C+ DCs 
## 5 NK cells_CD14+C… HSP90B1_AS… 0.592     0.300    0.0779 8.65e-5 NK cells  
## 6 CD14-CD16+ mono… ICAM2_ITGAL 0.531     0.219    0.0740 1.22e-5 CD14-CD16…
## 7 CD14-CD16+ mono… LRPAP1_SOR… 0.452     0.337    0.0305 8.90e-5 CD14-CD16…
## 8 CD14-CD16+ mono… TIMP1_CD63  1.43      0.801    0.153  2.10e-5 CD14-CD16…
## 9 CD8 T cells_CD4… TNFSF12_TN… 0.180     0.0725   0.0197 2.06e-8 CD8 T cel…
## # … with 3 more variables: cell_type2 &lt;chr&gt;, interact_ratio &lt;dbl&gt;,
## #   p_val_adj &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Run celltalker - Tonsil</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>tonsil_interactions <span class="ot">&lt;-</span> <span class="fu">celltalk</span>(<span class="at">input_object=</span>ser_split[[<span class="st">"Tonsil"</span>]],</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">metadata_grouping=</span><span class="st">"cell_types"</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ligand_receptor_pairs=</span>ramilowski_pairs,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">number_cells_required=</span><span class="dv">50</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_expression=</span><span class="dv">1000</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_expression=</span><span class="dv">20000</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">scramble_times=</span><span class="dv">10</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Check out the interactions - tonsil</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>tonsil_interactions <span class="sc">%&gt;%</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_val_adj=</span><span class="fu">p.adjust</span>(p_val,<span class="at">method=</span><span class="st">"fdr"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_val_adj<span class="sc">&lt;</span><span class="fl">0.05</span>)</span></code></pre></div>
<pre><code>## # A tibble: 13 x 10
##    interaction_pai… interaction value scram_mean scram_sd    p_val cell_type1
##    &lt;chr&gt;            &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;     
##  1 B cells_NK cells ADAM28_ITG… 0.502     0.165   0.0951  2.01e- 4 B cells   
##  2 NK cells_CD1C+ … APP_NCSTN   0.237     0.101   0.0404  3.48e- 4 NK cells  
##  3 CD1C+ DCs_CD1C+… CALR_HLA-F  1.06      0.753   0.0910  3.69e- 4 CD1C+ DCs 
##  4 CD8 T cells_B c… CCL5_CXCR3  1.67      0.230   0.195   8.42e-14 CD8 T cel…
##  5 CD8 T cells_CD4… CCL5_CXCR3  1.69      0.222   0.185   1.33e-15 CD8 T cel…
##  6 CD8 T cells_CD8… CCL5_CXCR3  1.96      0.395   0.480   5.50e- 4 CD8 T cel…
##  7 CD4 T cells_Pla… CD40LG_TRA… 0.307     0.0584  0.00905 0.       CD4 T cel…
##  8 CD1C+ DCs_CD8 T… GNAI2_CXCR3 0.784     0.289   0.123   2.99e- 5 CD1C+ DCs 
##  9 CD1C+ DCs_CD1C+… IL16_CD4    0.568     0.321   0.0647  6.62e- 5 CD1C+ DCs 
## 10 NK cells_CD1C+ … LTA_TNFRSF… 0.387     0.169   0.0498  5.69e- 6 NK cells  
## 11 NK cells_CD1C+ … LTA_TNFRSF… 0.354     0.0881  0.0582  2.42e- 6 NK cells  
## 12 B cells_Plasmab… LY86_CD180  0.522     0.0824  0.0798  1.80e- 8 B cells   
## 13 NK cells_NK cel… TNFSF12_TN… 0.427     0.0829  0.0616  1.11e- 8 NK cells  
## # … with 3 more variables: cell_type2 &lt;chr&gt;, interact_ratio &lt;dbl&gt;,
## #   p_val_adj &lt;dbl&gt;</code></pre>
</div>
<div id="create-circos-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#create-circos-plots" class="anchor"></a>Create circos plots</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot top 3 interactions - PBMC</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>top_stats_pbmc <span class="ot">&lt;-</span> pbmc_interactions <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_val_adj=</span><span class="fu">p.adjust</span>(p_val,<span class="at">method=</span><span class="st">"fdr"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_val_adj<span class="sc">&lt;</span><span class="fl">0.05</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cell_type1) <span class="sc">%&gt;%</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">3</span>,interact_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign colors to cell types</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>all_cell_types <span class="ot">&lt;-</span> <span class="fu">unique</span>(ser_obj[[<span class="st">"cell_types"</span>]][,<span class="dv">1</span>])</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>colors_use <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n=</span><span class="dv">8</span>,<span class="st">"Set2"</span>))(<span class="fu">length</span>(all_cell_types))</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(colors_use) <span class="ot">&lt;-</span> all_cell_types</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="fu">circos_plot</span>(<span class="at">ligand_receptor_frame=</span>top_stats_pbmc,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">cell_group_colors=</span>colors_use,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">ligand_color=</span><span class="st">"blue"</span>,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">receptor_color=</span><span class="st">"red"</span>,</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex_outer=</span><span class="fl">0.5</span>,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex_inner=</span><span class="fl">0.4</span>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="consistent_interactions_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot top 3 interactions - Tonsil</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>top_stats_tonsil <span class="ot">&lt;-</span> tonsil_interactions <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_val_adj=</span><span class="fu">p.adjust</span>(p_val,<span class="at">method=</span><span class="st">"fdr"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_val_adj<span class="sc">&lt;</span><span class="fl">0.05</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cell_type1) <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">3</span>,interact_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">circos_plot</span>(<span class="at">ligand_receptor_frame=</span>top_stats_tonsil,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cell_group_colors=</span>colors_use,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ligand_color=</span><span class="st">"blue"</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">receptor_color=</span><span class="st">"red"</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex_outer=</span><span class="fl">0.5</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">cex_inner=</span><span class="fl">0.4</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="consistent_interactions_files/figure-html/unnamed-chunk-2-2.png" width="700"></p>
</div>
<div id="identify-significantly-different-interactions-across-patient-samples" class="section level2">
<h2 class="hasAnchor">
<a href="#identify-significantly-different-interactions-across-patient-samples" class="anchor"></a>Identify significantly different interactions across patient samples</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split Seurat object into lists</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>ser_obj_list <span class="ot">&lt;-</span> <span class="fu">SplitObject</span>(ser_obj,<span class="at">split=</span><span class="st">"sample_type"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate significance of interactions across replicates</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>consistent_tonsil_interactions <span class="ot">&lt;-</span>  <span class="fu">compare_group_interactions</span>(</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">interactions_stats=</span>top_stats_tonsil,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_replicates=</span><span class="st">"sample_id"</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_group_1=</span>ser_obj_list[[<span class="st">"Tonsil"</span>]],</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_group_2=</span>ser_obj_list[[<span class="st">"PBMC"</span>]])</span></code></pre></div>
<pre><code>## Warning in wilcox.test.default(score1, score2): cannot compute exact p-value
## with ties

## Warning in wilcox.test.default(score1, score2): cannot compute exact p-value
## with ties</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Significant interactions with type I error control with FDR</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>consistent_tonsil_interactions <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_val_adj=</span><span class="fu">p.adjust</span>(p_value,<span class="at">method=</span><span class="st">"fdr"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_val_adj<span class="sc">&lt;</span><span class="fl">0.05</span>)</span></code></pre></div>
<pre><code>##    cell_type1   cell_type2 ligand receptor mean_group1 mean_group2     p_value
## 1   CD1C+ DCs    CD1C+ DCs   CALR    HLA-F   1.3970461   0.6879709 0.007936508
## 2 CD4 T cells Plasmablasts CD40LG    TRAF3   0.5648783   0.2022593 0.007936508
## 3    NK cells    CD1C+ DCs    LTA TNFRSF1B   0.2888214   0.0114413 0.007936508
## 4     B cells Plasmablasts   LY86    CD180   0.9367137   0.3763581 0.011925234
##    p_val_adj
## 1 0.03174603
## 2 0.03174603
## 3 0.03174603
## 4 0.03577570</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot of joint weight interaction across replicates</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot_group_interaction</span>(<span class="at">ligand=</span><span class="st">"CD40LG"</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">receptor=</span><span class="st">"TRAF3"</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cell_type1=</span><span class="st">"CD4 T cells"</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">cell_type2=</span><span class="st">"Plasmablasts"</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_replicates=</span><span class="st">"sample_id"</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_group_1=</span>ser_split[[<span class="st">"Tonsil"</span>]],</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_group_2=</span>ser_split[[<span class="st">"PBMC"</span>]])</span></code></pre></div>
<p><img src="consistent_interactions_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#load-packages-and-setup-analysis">Load packages and setup analysis</a></li>
      <li><a href="#run-celltalker">Run celltalker</a></li>
      <li><a href="#create-circos-plots">Create circos plots</a></li>
      <li><a href="#identify-significantly-different-interactions-across-patient-samples">Identify significantly different interactions across patient samples</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Anthony Cillo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
